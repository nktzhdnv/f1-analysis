<!DOCTYPE html>
<html lang="ru">

<head>
  <meta charset="UTF-8">
  <title>simple-f1-web</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body {
      background-color: white;
      padding: 20px;
    }

    .graph-section,
    .race-info,
    .prediction-block {
      background: white;
      padding: 20px;
      margin: 20px 0;
    }

    .prediction-header {
      background: #cf3636;
      color: white;
      padding: 15px;
      margin-bottom: 20px;
    }
  </style>
</head>

<body>
  <div class="container">

    <div class="text-center mb-4">
      <h1 style="color: black;">Simple F1</h1>
    </div>

    <!-- Последняя и след гонки -->
    <div class="race-info">
      <div class="row">
        <div class="col-md-6">
          <h4>Последняя гонка</h4>
          <p class="h5 text-success">{{ last_race_name }}</p>
          <p>{{ last_race_date }}</p>
        </div>
        <div class="col-md-6">
          <h4>Следующая гонка</h4>
          <p class="h5 text-primary">{{ next_race_name }}</p>
          <p>{{ next_race_date }}</p>
        </div>
      </div>
    </div>


    <div class="prediction-block">
      <div class="prediction-header text-center">
        <h3>Прогноз на следующую гонку: {{ next_track_name }}</h3>
      </div>

      <div class="row">
        <!-- Исторические результаты -->
        <div class="col-md-4">
          <h5>История трассы</h5>
          {% if track_history %}
          <div class="table-responsive">
            <table class="table table-sm">
              <thead>
                <tr>
                  <th>Год</th>
                  <th>Победитель</th>
                  <th>Команда</th>
                </tr>
              </thead>
              <tbody>
                {% for race in track_history %}
                <tr>
                  <td>{{ race.year }}</td>
                  <td>{{ race.winner }}</td>
                  <td>{{ race.team }}</td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
          {% else %}
          <p class="text-muted">Исторические данные загружаются...</p>
          {% endif %}
        </div>

        <!-- Текущая форма -->
        <div class="col-md-4">
          <h5>Текущая форма, перформанс в сезоне</h5>
          {% if current_form %}
          <div class="table-responsive">
            <table class="table table-sm">
              <thead>
                <tr>
                  <th>Гонщик</th>
                  <th>Ср. очки</th>
                  <th>Гонок</th>
                </tr>
              </thead>
              <tbody>
                {% for driver in current_form %}
                <tr>
                  <td>{{ driver.driver }}</td>
                  <td><strong>{{ driver.avg_points }}</strong></td>
                  <td>{{ driver.races }}</td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
          {% endif %}
        </div>

        <!-- Рейтинг на трассе -->
        <div class="col-md-3">
          <h5>Рейтинг на трассе за последние 3 года</h5>
          {% if track_rating %}
          <div class="table-responsive">
            <table class="table table-sm">
              <thead>
                <tr>
                  <th>Гонщик</th>
                  <th>Рейтинг</th>
                </tr>
              </thead>
              <tbody>
                {% for driver in track_rating %}
                <tr>
                  <td>{{ driver.driver }}</td>
                  <td><strong>{{ driver.rating }}</strong></td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
          {% endif %}
        </div>

        <!-- Прогноз -->
        <div class="col-md-4">
          <h5>Прогноз, тут вообще много всего можно еще</h5>
          <div class="alert alert-info">
            {{ expert_prediction }}
          </div>
        </div>
      </div>
    </div>

    <div class="mt-3">
      <h5>Как посчитан рейтинг?</h5>
      <ul>
        <li>РЕЙТИНГ = Средние очки + Коэф позиции + Коэф стабильности</li>
        <li>Средние очки: Все очки гонщика на этой трассе за 3 года делим на количество гонок</li>
        <li>Коэф позиции: position_bonus = (20 - best_position) * 0.5, например - Победа (1 место): (20 - 1) * 0.5 =
          9.5, 3 место: (20 - 3) * 0.5 = 8.5, 10 место: (20 - 10) * 0.5 = 5.0</li>
        <li>Коэф стабильности: consistency_bonus = min(5, 10 / np.std(positions)) - меньше разброс = больше бонус</li>

      </ul>
    </div>

    {% if track_performance_success %}
    <div class="graph-section">
      <h3>Исторические результаты на трассе {{ next_track_name }}</h3>
      <p>Динамика позиций топ-гонщиков за последние годы (чем выше линия - тем лучше результат)</p>
      <img src="{{ url_for('static', filename='images/track_performance.png') }}" class="img-fluid"
        alt="Исторические результаты на трассе">
      <div class="mt-3">
        <h5>Анализ:</h5>
        <ul>
          <li>Ферстаппен и Леклерк хорошо показывают себя на трассе, шанс победить выше</li>
        </ul>
      </div>
    </div>
    {% endif %}

    <div class="prediction-block">
      <div class="prediction-header text-center">
        <h3>Анализ предыдущей: {{ last_track_name }}</h3>
      </div>
      {% if analysis_success %}
      <div class="graph-section">
        <h3>Анализ стратегий пит-стопов</h3>
        <img src="{{ url_for('static', filename='images/pitstop_analysis.png') }}" class="img-fluid"
          alt="Анализ пит-стопов">
      </div>
      {% endif %}

      {% if laptimes_success %}
      <div class="graph-section">
        <h3>Сравнение времени кругов</h3>
        <img src="{{ url_for('static', filename='images/laptimes_analysis.png') }}" class="img-fluid"
          alt="Сравнение времени кругов">
        <div class="mt-3">
          <h5>Анализ:</h5>
          <ul>
            <li>По графикам видно, как время круга гонщика сильно возрастает при пит-стопах</li>
            <li>В начале графика в первое время гонщики мешают друг другу, поэтому происходит возрастание во времени
              кругов</li>
            <li>Графики показывают, что когда у команд разное время пит-стопов: у всех время круга падает</li>
            <li>Несмотря на три пит-стопа у Ферстаппена (VER), его профессионализм позволил встать на подиум</li>
          </ul>
        </div>
      </div>
      {% endif %}
    </div>
  </div>
</body>

</html>